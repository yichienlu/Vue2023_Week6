import{_ as k,r as b,o as d,c as i,a as t,g as $,F as v,f as x,t as c,d as f,b as l,w as y,h as P,v as V,n as g}from"./index-55c07cb5.js";const{VITE_APP_URL:r,VITE_APP_PATH:_}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"yclu",BASE_URL:"/Vue2023_Week6/",MODE:"production",DEV:!1,PROD:!0},E={data(){return{products:[],productId:"",cart:{},loadingItem:""}},methods:{getProducts(){this.$http.get(`${r}/api/${_}/products/all`).then(e=>{this.products=e.data.products}).catch(e=>{console.log(e)})},getCarts(){this.$http.get(`${r}/api/${_}/cart`).then(e=>{this.cart=e.data.data}).catch(e=>{console.log(e)})},updateCartItem(e){const a={product_id:e.product.id,qty:e.qty};this.loadingItem=e.id,this.$http.put(`${r}/api/${_}/cart/${e.id}`,{data:a}).then(u=>{this.cart=u.data.data,this.getCarts(),this.loadingItem=""}).catch(u=>{console.log(u)})},deleteCartItem(e){this.loadingItem=e.id,this.$http.delete(`${r}/api/${_}/cart/${e.id}`).then(a=>{console.log("更新購物車",a.data),this.getCarts(),this.loadingItem=""}).catch(a=>{console.log(a)})},clearCart(){this.$http.delete(`${r}/api/${_}/carts`).then(()=>{this.getCarts(),this.loadingItem=""}).catch(e=>{console.log(e)})},isPhone(e){return/^(09)[0-9]{8}$/.test(e)?!0:"需要正確的電話號碼"}},mounted(){this.getCarts()}},w={class:"text-end"},q={key:0,class:"table align-middle"},A=t("thead",null,[t("tr",null,[t("th"),t("th",null,"品名"),t("th",{style:{width:"150px"}},"數量/單位"),t("th",null,"單價")])],-1),T=["onClick","disabled"],D=t("div",{class:"text-success"},"已套用優惠券",-1),N={class:"input-group input-group-sm"},U={class:"input-group mb-3"},B=["onUpdate:modelValue","onChange","disabled"],L=["value"],R={class:"input-group-text",id:"basic-addon2"},M={class:"text-end"},S={class:"text-success"},F=t("td",{colspan:"3",class:"text-end"},"總計",-1),H={class:"text-end"},O=t("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),j={class:"text-end text-success"},z={key:1,class:"text-center"},W={class:"my-5 row justify-content-center"},G={class:"mb-3"},J=t("label",{for:"email",class:"form-label"},"Email",-1),K={class:"mb-3"},Q=t("label",{for:"name",class:"form-label"},"收件人姓名",-1),X={class:"mb-3"},Y=t("label",{for:"tel",class:"form-label"},"收件人電話",-1),Z={class:"mb-3"},tt=t("label",{for:"address",class:"form-label"},"收件人地址",-1),et=t("div",{class:"mb-3"},[t("label",{for:"message",class:"form-label"},"留言"),t("textarea",{id:"message",class:"form-control",cols:"30",rows:"10"})],-1),st={class:"text-end"},lt=["disabled"];function at(e,a,u,ot,o,h){const C=b("router-link"),m=b("v-field"),p=b("error-message"),I=b("v-form");return d(),i("div",null,[t("div",w,[t("button",{class:"btn btn-outline-danger",type:"button",onClick:a[0]||(a[0]=$(s=>h.clearCart(),["prevent"]))},"清空購物車")]),o.cart.total?(d(),i("table",q,[A,t("tbody",null,[(d(!0),i(v,null,x(o.cart.carts,s=>(d(),i("tr",{key:s.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:n=>h.deleteCartItem(s),disabled:s.id===o.loadingItem}," x ",8,T)]),t("td",null,[f(c(s.product.title)+" ",1),D]),t("td",null,[t("div",N,[t("div",U,[P(t("select",{name:"",id:"",class:"form-control","onUpdate:modelValue":n=>s.qty=n,onChange:n=>h.updateCartItem(s),disabled:s.id===o.loadingItem},[(d(),i(v,null,x(20,n=>t("option",{value:n,key:`${n}unit`},c(n),9,L)),64))],40,B),[[V,s.qty]]),t("span",R,c(s.product.unit),1)])])]),t("td",M,[f(c(s.total)+" ",1),t("small",S,"折扣價："+c(s.final_total),1)])]))),128))]),t("tfoot",null,[t("tr",null,[F,t("td",H,c(o.cart.total),1)]),t("tr",null,[O,t("td",j,c(o.cart.final_total),1)])])])):(d(),i("div",z,[f("購物車空空如也，"),l(C,{to:"/products",class:""},{default:y(()=>[f("去購物")]),_:1})])),t("div",W,[l(I,{ref:"form",class:"col-md-6"},{default:y(({errors:s})=>[t("div",G,[J,l(m,{id:"email",name:"email",type:"email",class:g(["form-control",{"is-invalid":s.email}]),placeholder:"請輸入 Email",rules:"required|email"},null,8,["class"]),l(p,{name:"email",class:"invalid-feedback"})]),t("div",K,[Q,l(m,{id:"name",name:"姓名",type:"text",class:g(["form-control",{"is-invalid":s.姓名}]),placeholder:"請輸入姓名",rules:"required"},null,8,["class"]),l(p,{name:"姓名",class:"invalid-feedback"})]),t("div",X,[Y,l(m,{id:"tel",name:"電話",type:"tel",class:g(["form-control",{"is-invalid":s.電話}]),placeholder:"請輸入電話",rules:h.isPhone},null,8,["class","rules"]),l(p,{name:"電話",class:"invalid-feedback"})]),t("div",Z,[tt,l(m,{id:"address",name:"地址",type:"text",class:g(["form-control",{"is-invalid":s.地址}]),placeholder:"請輸入地址",rules:"required"},null,8,["class"]),l(p,{name:"地址",class:"invalid-feedback"})]),et,t("div",st,[t("button",{type:"submit",class:"btn btn-danger",disabled:!o.cart.total},"送出訂單",8,lt)])]),_:1},512)])])}const ct=k(E,[["render",at]]);export{ct as default};
